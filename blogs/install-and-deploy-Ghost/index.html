<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>install_and_deploy_Ghost - Emerald Dream</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这篇文章介绍如何在Linux服务器上从零开始搭建Ghost博客。  
服务器信息：Vultr-Tokyo：&amp;nbsp;&amp;nbsp;RAM: 768M&amp;nbsp;&amp;nbsp;CPU: 1 Core&amp;nbsp;&amp;nbsp;Storage: 15GB SSD&amp;nbsp;&amp;nbsp;O/S: Debian 7 x64 (wheezy)
1. 安装Node.js  
Ghost博客运行在Node.js之上，">
<meta property="og:type" content="article">
<meta property="og:title" content="install_and_deploy_Ghost">
<meta property="og:url" content="http://x.zyx.im/blogs/install-and-deploy-Ghost/index.html">
<meta property="og:site_name" content="Emerald Dream">
<meta property="og:description" content="这篇文章介绍如何在Linux服务器上从零开始搭建Ghost博客。  
服务器信息：Vultr-Tokyo：&amp;nbsp;&amp;nbsp;RAM: 768M&amp;nbsp;&amp;nbsp;CPU: 1 Core&amp;nbsp;&amp;nbsp;Storage: 15GB SSD&amp;nbsp;&amp;nbsp;O/S: Debian 7 x64 (wheezy)
1. 安装Node.js  
Ghost博客运行在Node.js之上，">
<meta property="og:image" content="https://dn-izyx.qbox.me/content/images/2016/07/First-Time-You-Visit.JPG">
<meta property="og:updated_time" content="2016-12-07T15:37:48.655Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="install_and_deploy_Ghost">
<meta name="twitter:description" content="这篇文章介绍如何在Linux服务器上从零开始搭建Ghost博客。  
服务器信息：Vultr-Tokyo：&amp;nbsp;&amp;nbsp;RAM: 768M&amp;nbsp;&amp;nbsp;CPU: 1 Core&amp;nbsp;&amp;nbsp;Storage: 15GB SSD&amp;nbsp;&amp;nbsp;O/S: Debian 7 x64 (wheezy)
1. 安装Node.js  
Ghost博客运行在Node.js之上，">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-72039031-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/categories">分类</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://x.zyx.im"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-install-and-deploy-Ghost" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      install_and_deploy_Ghost
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/blogs/install-and-deploy-Ghost/" class="article-date">
  <time datetime="2016-12-07T15:37:01.000Z" itemprop="datePublished">2016-12-07</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/Server/">Server</a>
  </div>

      
        <div class="article-comment-link-wrap">
          <a href="http://x.zyx.im//blogs/install-and-deploy-Ghost/#disqus_thread" class="article-comment-link">评论</a>
        </div>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章介绍如何在Linux服务器上从零开始搭建Ghost博客。  </p>
<p>服务器信息：<br><a href="http://www.vultr.com/?ref=6846816" target="_blank" rel="external">Vultr-Tokyo</a>：<br>&nbsp;&nbsp;RAM: 768M<br>&nbsp;&nbsp;CPU: 1 Core<br>&nbsp;&nbsp;Storage: 15GB SSD<br>&nbsp;&nbsp;O/S: Debian 7 x64 (wheezy)</p>
<p><strong>1. 安装Node.js</strong>  </p>
<p>Ghost博客运行在Node.js之上，所以在服务器上搭建Ghost之前，需要先安装Node.js环境。下面采用编译源代码的方式安装。<br><a href="http://support.ghost.org/supported-node-versions/" target="_blank" rel="external">根据Ghost官方的建议</a>，我们选择Node.js Version 0.10.40。  </p>
<p>1) 升级系统并在系统中安装好编译Node.js所需的环境</p>
<pre>
apt-get update
apt-get install python gcc make g++
</pre>

<p>2) 获取Node.js的源代码  </p>
<pre>
wget https://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz
tar zxvf node-v0.10.40.tar.gz
</pre>

<p>3) 编译源代码<br>首先进入Node.js所在目录</p>
<pre>
cd node-v0.10.40.tar.gz
</pre>
编译
<pre>
./configure
make install
</pre>
稍等片刻，Node.js即可安装成功。
通过检测版本信息来验证Nodejs是否可以正常运行：  
<pre>
node -v
</pre>
如果输出`v 0.10.40`即说明Nodejs已运行。  

**2. 安装Ghost**  

1) 下载Ghost
从官方源下载最新版的Ghost，<a title="2016年七月9日">当前</a>的最新版是v0.8.0。
<pre>
curl -L https://ghost.org/zip/ghost-latest.zip -o ghost.zip
</pre>
建议将Ghost解压到`/var/www/ghost`目录中（如果不存在`/var/www/`目录，请提前创建）：
<pre>
unzip -uo ghost.zip -d /var/www/ghost
</pre>
安装：
<pre>
cd /var/www/ghost
npm install --production
</pre>
当该步骤完成以后，Ghost已经成功安装。  
由于GFW的原因，国内的服务器很有可能无法成功安装Ghost所需的npm包，导致Ghost默认使用的数据库sqlite3丢失，从而使Ghost无也无法正常使用。我们可以自行安装Mysql并修改Ghost相关配置来解决这个问题，具体做法可以参考：  
[使用MySQL驱动Ghost博客](https://zyx.im/a-ghost-blog-powered-by-mysql/)   

**3.初次运行**  

使Ghost在生产环境下运行
<pre>
npm start --production
</pre>
如果返回的命令如下，说明Ghost可以正常运行。  
![Result](https://dn-izyx.qbox.me/content/images/2016/07/ssh%20result.JPG)
~~现在，Ghost已经运行在了默认的端口`127.0.0.1:2368`。  
·你可以在浏览器中输入`http://your-ip-address:2368`来访问Ghost。通过`http://your-ip-address:2368/ghost`来对你的博客进行相关设置和自定义。~~

**4. 对Ghost进行一些必要的配置**  

1) 在你第一次运行Ghost后，Ghost所在目录下会产生两个文件`config.js`和`index.js`。你可以在`config.js`中对Ghost进行一些底层的配置，如URL、数据库、邮件服务器等等。其中最最重要的配置便是将Ghost的URL换成自定义的地址。例如：
<pre>
    production: {
        url: 'http://jp.ss.zyx.im',
        mail: {},
        database: {
            client: 'sqlite3',
            connection: {
                filename: path.join(__dirname, '/content/data/ghost.db')
            },
            debug: false
        },
</pre>
在`config.js`修改以上配置，可以将Ghost的URL从默认的`http://my-ghost-blog.com`更改为：`http://jp.ss.zyx.im`。

更多关于`config.js`的作用可以参考：  
[Deploying Ghost](http://support.ghost.org/config/)

2) 让Ghost在后台运行
`npm start --production`的一个问题是，这个命令只是让Ghost保持在前台运行，当你输入`Ctrl+C`或者退出SSH后，Ghost会停止运行。这肯定不是我们所期望的，因为对一个网站的最基本要求是它应该一直保持在线……  
我们通过为Ghost添加Init Script来实现Ghost的后台持续运行。Ghost官方已经给出了实现这个功能的脚本，下载并进行一些简单的修改即可使用。  
下载：
<pre>
curl https://raw.githubusercontent.com/TryGhost/Ghost-Config/master/init.d/ghost \
  -o /etc/init.d/ghost
</pre>
注意以下几点：  
·打开脚本，将`GHOST_ROOT`变量修改为Ghost所在的目录。  
·检查`DAEMON`变量的值是否和`which node`的输出值相同。   

·init script只能被具有Ghost所有权的用户与用户组运行，所以我们需要建立Ghost专用的用户与用户组：  
<pre>
useradd -r ghost -U
chown -R ghost:ghost /path/to/ghost
chmod 755 /etc/init.d/ghost
</pre>
今后你就可以通过以下命令来对Ghost的运行与停止等任务进行控制了：
<pre>
service ghost start      启动
service ghost stop       停止
service ghost restart    重启
service ghost status     检查状态
</pre>
为了让Ghost能够随服务器开机自动启动，我们需要将刚刚创建的初始化脚本注册为为启动项。 输入以下命令：
<pre>
update-rc.d ghost defaults
update-rc.d ghost enable
</pre>

<p>4) 使用Nginx反代Ghost实现Ghost的正常访问<br>此时，当你输入<code>service ghost start</code>后，输入Ghost博客的地址，浏览器依旧会显示无法访问。我们通过使用Nginx对Ghost进行反向代理来彻底解决这个问题。<br>安装Nginx</p>
<p><pre><br>apt-get install nginx<br></pre><br>进入<code>sites-available</code>目录为Ghost添加站点配置</p>
<p><pre><br>cd /etc/nginx/sites-availalbe<br>nano ghost.conf<br></pre><br>在<code>ghost.conf</code>中写入如下配置信息：</p>
<p><pre><br>server {<br>    listen 80;<br>    server_name example.com;</pre></p>
<pre><code><span class="title">location</span> / {
    <span class="title">proxy_set_header</span>   X-Real-IP <span class="variable">$remote_addr</span>;
    <span class="title">proxy_set_header</span>   Host      <span class="variable">$http_host</span>;
    <span class="title">proxy_pass</span>         <span class="url">http://127.0.0.1:2368</span>;
}
</code></pre><p>}<br><br>将<code>server_name</code>中的<code>example.com</code>改为你自己的域名。保存。<br>将配置文件软链接到<code>sites-enabled</code>目录下：</p>
<p><pre><br>ln -s /etc/nginx/sites-available/ghost.conf /etc/nginx/sites-enabled/ghost.conf<br></pre><br>重启Nginx后，你就可以使用自己的域名访问你的Ghost博客了。<br><img src="https://dn-izyx.qbox.me/content/images/2016/07/First-Time-You-Visit.JPG" alt="First time u see"><br>你可以在<code>http://your-ghost-blog/ghost</code>对Ghost博客进行自定义设置。  </p>
<p>至此，一个Ghost博客成功搭建。</p>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Blog/">Blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ghost/">Ghost</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blogs/android6-0-for-Nexus5/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          android6.0_for_Nexus5
        
      </div>
    </a>
  
  
    <a href="/blogs/a-error-on-letsencrypt-updating/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">a_error_on_letsencrypt_updating&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Emerald Dream.
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.    a Github Page
    </div>
  </div>
</footer>
    
<script>
  var disqus_shortname = 'tech-zyx';
  
  var disqus_url = 'http://x.zyx.im//blogs/install-and-deploy-Ghost/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65033741-1', 'auto');
  ga('send', 'pageview');

</script>

  </div>
</body>
</html>